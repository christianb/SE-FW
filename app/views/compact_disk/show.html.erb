<% content_for :title, @cd.title+" ("+@cd.artist+")" %>
<div style="margin-left:20px;">
<% if flash[:notice] %>
	<div class="alert-message success">
		<a class="alert_close" href="#">×</a>
		<%= flash[:notice] %></p>
	</div>
<% end %>
</div>

<div class="row show-grid" >
	<div class="span11" style="margin-left:39px;">
		
		<% if !user_signed_in? || current_user.id != @cd.user_id %>
			<p>
				<b>Showcase von:</b>
				<%= link_to @user.firstname + ' ' + @user.lastname, allUserCDs_path(@cd.user_id) %>
			</p>
		<% end %>
		
		<% if !@cd.genre.empty?%>
			<p>
				<b>Genre:</b>
				<%= @cd.genre %>
			</p>
		<% end %>
		
		<% if @cd.year != nil %>
			<p>
				<b>Erscheinungsjahr:</b>
				<%= @cd.year %>
			</p>
		<% end %>
		
		<% if !@cd.description.empty? %>
			<p>
				<b>Beschreibung:</b>
				<%= @cd.description %>
			</p>
		<% end %>

		<% if !@songs.empty?%>
			<p>
			<b>Songs:</b><br/>
			<% @songs.each_with_index do |s, index| %>
				<%= index + 1 %>
				<%= s.title %>
				</br>
			<% end %>
			</p>
		<% end %>	
		
		<% if @cd.audio_file_name != nil %>
			<p>
			<b>DemoSong</b>
			</p>
			<p> <audio controls="controls">
				<!-- Dateiname ohne Extension -->
				<% filename = File.basename(@cd.audio_file_name, File.extname(@cd.audio_file_name).downcase)%>
				<% path = @cd.audio.url.chomp(@cd.audio_file_name) %>
				<!-- MP3 -->
				<source src=<%='"'.html_safe+ path+filename+'.mp3"'.html_safe %> type=<%='"audio/mp3"'.html_safe %>  />
				
				<!-- Ogg-->	
				<source src=<%='"'.html_safe+ path+filename+'.ogg"'.html_safe %> type=<%='"audio/ogg"'.html_safe %>  />
			  Your browser does not support the audio element.
			</audio>
			</p>
		<% end %>
		
		<p>
			<b>Sterne:</b> <%= @cd.rank.to_s %> 
			<% if current_user.id != @cd.user_id %>
				(<%= link_to 'Like', like_cd_path(@cd.id) %>)
			<% end %>
		</p>
		
	</div>
	<div class="span5">
        <%= image_tag @cd.photo.url(:normal) %>
    </div>
</div>

<div class="row show-grid">
	
	<div class="actions"> 
	<% if user_signed_in? && @cd.user_id == current_user.id%>
		<%= link_to 'Zurück', myCDs_path, :class => "btn default" %>
		<%= link_to 'Bearbeiten', edit_compact_disk_path(@cd), :class => "btn primary" %>
		
		<% if @cd.audio_file_name != nil %>
		<div style=" float:right;">
			<%= link_to "Demo Song löschen", delete_demo_songs_path(@cd), :confirm => "Wollen sie die Demo Songs wirklich löschen?", :method => :delete, :class => "btn danger" %>
		</div>
		<% end %>
	<% else %>
		<%= link_to 'Zurück', :back, :class => "btn default" %>
		<% if user_signed_in? %>
			<!--<% if current_user.id != @cd.user_id %>
				<%= link_to 'Like', like_cd_path(@cd.id), :class => "btn success" %>
			<% end %>-->
			
			<% if !@cd.in_transaction && @cd.visible %>
				<%= link_to 'Tauschen', swap_cd_path(@cd.id), :class => "btn primary" %>
			<% end %>
		<% end %>
		<% if user_signed_in? && AdminController.isAdmin(current_user) %>
			<div style=" float:right;">
			<% if @cd.audio_file_name != nil %>
				<%= link_to "Demosong löschen", delete_demo_songs_path(@cd), :confirm => "Wollen sie die Demo Songs wirklich löschen?", :method => :delete, :class => "btn danger" %>
			<% end %>
		
			
				<%= link_to "CD löschen", @cd, :confirm => "Wollen die CD \""+ @cd.title+"\" von "+User.find(@cd.user_id).firstname+" "+User.find(@cd.user_id).lastname+" wirklich löschen?", :method => :delete, :class => "btn danger" %>
			</div>
		<% end %>
	<% end %>
	</div>
</div>
