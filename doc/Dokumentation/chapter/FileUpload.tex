\section{File Upload (Paperclip)}
\label{sec:File Upload (Paperclip)}
In der Webanwendung sollen zwei Arten von Dateien hochgeladen werden können: Bilder und Audio. Um Dateien zum Server zu laden stehen für Rails zwei Plugins in Rails zur Verfügung Attachment-fu und Paperclip\footnote{https://github.com/thoughtbot/paperclip}. Wir haben uns für Paperclip entschieden das etwas flexibler als Attachment-fu ist. Möchte man Bilder mit Paperclip zum Server hochladen wird zusätzlich noch das Tool ImageMagick benötigt, welches in der Lage ist verschiedene Versionen eines Bildes zu erstellen sowie die Meta-Informationen auszulesen. Im Model wird definiert welche Art von Datei hochgeladen werden kann. So sollen in für den User als auch für die CD's Bilder hochgeladen werden können. Dazu müssen in der Datenbank zusätzliche Spalten angelegt werden. Paperclip speichert die hochgeladenen Daten nicht in der Datenbank sondern auf dem Dateisystem. In der Datenbank wird lediglich die URL zu der Datei gespeichert. Das macht den ganzen Prozess wesentlich performanter, da die Datenbank nicht so vollgestopft wird. Das hochladen von Audio funktioniert fast genauso, nur das man hier auf andere Mime-Types prüft. Es hat sich gezeigt dsa verschiedene Browser und auch verschiedene Plattformen unterschiedlich mit den Mime-Types umgehen. Mit Paperclip kann sehr schnell ein Datei Upload eingerichtet werden. 
Im folgenden ist zu sehen wie ein Attachment dem Model hinzugefügt werden kann inklusive Validierung. Im folgenden ist für das Model User die Anpassung zu sehen um ein Cover hochzuladen. Die entsprechenden Attribute müssen in der Datenbank in der entsprechenden Tabelle über eine Migration eingefügt werden.
\lstinputlisting[language=Ruby]{chapter/file_upload.rb}